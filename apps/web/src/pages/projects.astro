---
import Layout from '../layouts/Layout.astro';
import Navigation from '../components/Navigation.astro';
import Footer from '../components/Footer.astro';
import { getCollection } from 'astro:content';

const allProjects = await getCollection('projects');
const projects = allProjects.sort((a, b) => b.data.date.localeCompare(a.data.date));

const categories = ['all', ...new Set(projects.map(p => p.data.category))];

const categoryLabels: Record<string, string> = {
  'all': 'All',
  'research': 'Research',
  'ml-ai': 'ML / AI',
  'full-stack': 'Full-Stack',
  'devops': 'DevOps',
  'open-source': 'Open Source',
};
---

<Layout title="Projects â€” Dhairya Mishra" description="Research and production projects spanning ML, full-stack, and cloud systems.">
  <Navigation />
  
  <main id="main-content" class="py-20 md:py-28">
    <section class="section-container">
      <!-- Header -->
      <div class="mb-14">
        <p class="text-neon-cyan font-mono text-sm tracking-widest uppercase mb-4 animate-fade-in">Portfolio</p>
        <h1 class="text-4xl md:text-5xl font-heading font-bold mb-4">
          <span class="text-gradient-neon">Projects</span>
        </h1>
        <p class="text-lg text-muted-light max-w-2xl">
          Research and production work spanning ML, full-stack systems, and cloud infrastructure. Each project includes a detailed write-up.
        </p>
      </div>

      <!-- Filter Bar -->
      <div class="flex flex-wrap gap-2 mb-10" id="filter-bar">
        {categories.map((cat) => (
          <button
            data-filter={cat}
            class={`filter-btn px-4 py-2 rounded-full text-xs font-heading font-medium tracking-wide border transition-all duration-200 ${
              cat === 'all'
                ? 'bg-neon-cyan/15 text-neon-cyan border-neon-cyan/30'
                : 'bg-transparent text-muted border-white/10 hover:border-white/20 hover:text-text'
            }`}
          >
            {categoryLabels[cat] || cat}
          </button>
        ))}
      </div>
      
      <!-- Project Grid -->
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6" id="project-grid">
        {projects.map((project, i) => (
          <a
            href={`/projects/${project.slug}`}
            data-category={project.data.category}
            class={`reveal reveal-delay-${(i % 5) + 1} group card-neon-interactive flex flex-col project-card`}
          >
            <!-- Neon accent bar -->
            <div class="h-1 w-full rounded-t-xl bg-gradient-to-r from-neon-cyan via-neon-violet to-neon-magenta mb-4 opacity-50 group-hover:opacity-100 transition-opacity"></div>
            
            <div class="flex items-start justify-between mb-3">
              <span class="badge-neon text-[10px]">{categoryLabels[project.data.category] || project.data.category}</span>
              {project.data.metric && (
                <div class="text-right">
                  <span class="text-lg font-heading font-bold text-neon-cyan">{project.data.metric}</span>
                  {project.data.metricLabel && <p class="text-[10px] text-muted">{project.data.metricLabel}</p>}
                </div>
              )}
            </div>
            
            <h3 class="text-lg font-heading font-semibold text-text-bright mb-2 group-hover:text-neon-cyan transition-colors">
              {project.data.title}
            </h3>
            
            <p class="text-sm text-muted leading-relaxed mb-4 flex-grow">
              {project.data.description}
            </p>
            
            <div class="flex flex-wrap gap-1.5 mt-auto mb-3">
              {project.data.tags.slice(0, 5).map(tag => (
                <span class="text-[10px] px-2 py-0.5 rounded-full bg-white/5 text-muted-light">{tag}</span>
              ))}
            </div>

            <div class="flex items-center text-xs text-neon-cyan/60 group-hover:text-neon-cyan transition-colors font-mono">
              Read more
              <svg class="w-3 h-3 ml-1 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" /></svg>
            </div>
          </a>
        ))}
      </div>
    </section>
  </main>

  <Footer />
</Layout>

<script>
  const buttons = document.querySelectorAll('.filter-btn');
  const cards = document.querySelectorAll('.project-card');

  buttons.forEach(btn => {
    btn.addEventListener('click', () => {
      const filter = btn.getAttribute('data-filter');

      buttons.forEach(b => {
        b.classList.remove('bg-neon-cyan/15', 'text-neon-cyan', 'border-neon-cyan/30');
        b.classList.add('bg-transparent', 'text-muted', 'border-white/10');
      });
      btn.classList.remove('bg-transparent', 'text-muted', 'border-white/10');
      btn.classList.add('bg-neon-cyan/15', 'text-neon-cyan', 'border-neon-cyan/30');

      cards.forEach(card => {
        const category = card.getAttribute('data-category');
        if (filter === 'all' || category === filter) {
          (card as HTMLElement).style.display = '';
        } else {
          (card as HTMLElement).style.display = 'none';
        }
      });
    });
  });
</script>
